<div class="container">
  <h5 class="text-dark bg-light py-4 mt-5 pl-2">レシピ投稿</h5>
  <%= form_with model: recipe, local:true do |f| %>
    <div class="row">
      <div class="col-md-12 col-sm-10 mx-2 mx-sm-auto text-center rounded px-0 align-self-center">
        <div class="row form-body p-4">
          <div class="col-md-5 mb-3">
                  <%#div class="mb-3"><img id="preview" style="width:40%;"></div>%>
            <%= f.attachment_field  :image, class: 'recipe_img_field', style: 'display:none;' %>
            <%= attachment_image_tag @recipe, :image, fallback: 'noimage.png', onClick: "$('.recipe_img_field').click()", class: 'center-block img-thumbnail img-responsive recipe_img_prev' %>
          </div>
          <div class="col input-group flex-column">
            <div class="input-group-prepend"></div>
            <strong><%= f.label :title, "レシピタイトル", class: "d-flex justify-content-start" %></strong>
            <%= f.text_field :title, placeholder:"フライパンとめんつゆで作る！簡単親子丼", class: "form-control mb-3", style:"width: 65%;" %>
            <div class="input-group-prepend"></div>
            <strong><%= f.label :time, "調理時間", class: "d-flex justify-content-start" %></strong>
            <%= f.text_field :time, placeholder:"30分", style:"width: 20%;", class: "form-control mb-3" %>
            <div class="input-group-prepend"></div>
            <strong><%= f.label :comment, "レシピコメント", class: "d-flex justify-content-start" %></strong>
            <%= f.text_area :comment, placeholder:"とろとろ卵の絶品親子丼です。卵は２回に分けて入れるのがポインです♪", style:"width: 100%; height: 100px;", class: "form-control"  %>
            <%= f.hidden_field :customer_id, :value => current_customer.id %>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-5 material_detail">
      <div class="col-md-12 col-sm-10 mx-2 mx-sm-auto rounded px-0 align-self-center">
        <h2>材料</h2>
        <div class="col-md-5 ml-6 d-flex align-items-center mb-4"><%= f.text_field :people, class: "form-control", placeholder:"例）2", style:"width: 30%;" %>人分</div>
        <%= f.fields_for :materials do |t| %>
          <%= render 'material_fields', f: t %>
        <% end %>
        <div id="detail-association-insertion-material"></div>
          <%= link_to_add_association "材料追加", f, :materials,
            class: "add_fields d-flex justify-content-center",
            id: 'add-btn ',
            data: {
                  association_insertion_node: '#detail-association-insertion-material',
                  association_insertion_method: 'before'
          }%>
      </div>
    </div>

    <div class="row mb-5 explanation">
      <div class="col-md-12 col-sm-10 mx-2 mx-sm-auto rounded px-0 align-self-center">
        <h2>作り方</h2>
        <%= f.fields_for :explanations do |t| %>
          <%= render partial: 'explanation_fields', locals: { f: t} %>
        <% end %>
        <div id="detail-association-insertion-explanation"></div>
        <%= link_to_add_association "工程追加", f, :explanations,
                  class: "add_fields d-flex justify-content-center",
                  id: 'add-btn',
                  data: {
                  association_insertion_node: '#detail-association-insertion-explanation',
                  association_insertion_method: 'before'
        }%>
      </div>
    </div>
    <div class="append__category">
      <div class="category">
        <div class="form__label">
          <div class="weight-bold-text lavel__name ">
                  カテゴリー
          </div>
          <div class="lavel__Required">
            <%= f.collection_select :category_id, @parents, :id, :name,{ include_blank: "選択してください"}, class:"serect_field" %>
          </div>
        </div>
      </div>
    </div>
    <div class="row justify-content-center"><%= f.submit "送信", class: "btn btn-success justify-content-center" %></div>
  <% end %>
</div>
<%= image_tag 'noimage.png', id: "no-image", style: 'display:none' %>
<script>
var str = $('#add-btn').attr('data-association-insertion-template')
//console.log(str)
var no_image = $('#no-image').attr('src');
var str = str.replace(/src="*"/,"src='"+ no_image + "' ")  
//console.log(str)
$('#add-btn').attr('data-association-insertion-template', str)
//console.log($('#add-btn').attr('data-association-insertion-template'))
</script>