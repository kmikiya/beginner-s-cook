<div class="container">
  <div class="row" >
    <div class="col">
      <%= attachment_image_tag @recipe, :image, :fill, 200, 200 %>
    </div>
    <div class="col">
      <div claas="row">

      <div>
        <% if @reports.exists? %>
        <span>平均評価：</span>
        <span id="star-rate-average"></span>
        <script>
          $('#star-rate-average').empty();
          $('#star-rate-average').raty({
            size: 36,
            starOff: "<%= asset_path('star-off.png') %>",
            starOn: "<%= asset_path('star-on.png') %>",
            starHalf: "<%= asset_path('star-half.png') %>",
            half: true,
            readOnly: true,
            score: <%= @average %>,
          });
        </script>
        (<%= @average %>点)
        <% else %>
        <span>平均評価：</span>
        <span id="star-rate-0"></span>
        <script>
          $('#star-rate-0').empty();
          $('#star-rate-0').raty({
            size: 36,
            starOff: "<%= asset_path('star-off.png') %>",
            starOn: "<%= asset_path('star-on.png') %>",
            starHalf: "<%= asset_path('star-half.png') %>",
            half: true,
            readOnly: true,
            score: <%= 0 %>,
          });
        </script>
        (<%= 0 %>点)
        <% end %>
    </div>


      <table class="table">
        <thead>
          <th>料理名</th>
          <th>調理時間</th>
          <th>紹介文</th>
        </thead>
        <tbody>
          <td><%= @recipe.title %></td>
         <td><%= @recipe.time %></td>
         <td><%= @recipe.comment %></td>
       </tbody>
     </table>
     </div>
     <div class="row">
           <p>この記事は<%= @recipe.favorites.count %>人のユーザーがお気に入りです。</p>
       <% if customer_signed_in? %>
       <% if @recipe.favorited_by?(current_customer) %>
        <p>
          <%= link_to recipe_favorites_path(@recipe), method: :delete do %>
            ♥お気に入りから外す
          <% end %>
         </p>
      <% else %>
        <p>
          <%= link_to recipe_favorites_path(@recipe), method: :post do %>
            ♡お気に入りに保存
          <% end %>
        </p>
      <% end %>
      <div><%= link_to "作ったreportを書く", new_recipe_report_path(@recipe) %></div>
      <%= link_to recipe_reports_path(@recipe) do %>
        <div>みんなが作った数　<%= @recipe.reports.count %>件</div>
      <% end %>
      <% if current_customer.id == @recipe.customer.id %>
        <%= link_to "レシピ編集", edit_recipe_path(@recipe) %>
        <%= link_to "レシピ削除", recipe_path(@recipe), method: :delete %>
      <% end %>
      <% end %>
     </div>
    </div>
        <%= link_to my_page_path(@recipe.customer) do %>
    <%= @recipe.customer.name %>
    <% end %>
  </div>


<div class="row">
　材料
  <table class="table">
    <thead>
      <th>材料名</th>
      <th>分量</th>
    </thead>
    <tbody>
      <% @materials.each do |material| %>
        <tr>
          <td><%= material.name %></td>
          <td><%= material.amount %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="row">
  <h2>作り方</h2>
</div>
  <div class="row">
    <div id="wrap">
      <div class="txt-show">
        <% @explanations.each do |explanation| %>
          <div class="col-md-3">
            <div><%= attachment_image_tag explanation, :process_image, :fill, 200, 200, class: "img-fluid" %></div>
            <div><%= explanation.explanation %></div>
     　    </div>
          <div class="txt-hide">
            <% explanation.comments.each do |comment| %>
              <div><%= comment.customer.name %></div>
              <div><%= comment.comment %></div>
              <div><%= link_to "削除", recipe_comments_path(explanation.recipe, comment_id: comment.id), method: :delete %></div>
            <% end %>
            <%= form_with model: @comment, url: recipe_comments_path(explanation.recipe), local:true do |f| %>
              <%= f.text_area :comment %>
              <%= f.hidden_field :customer_id, :value => current_customer.id %>
              <%= f.hidden_field :explanation_id, :value => explanation.id %>
              <%= f.submit %>
            <% end %>
          </div>
          <button class="more"></button>
        <% end %>
      </div>
    </div>
  </div>

<script>
  $(function(){
  $(".more").on("click", function() {
    $(this).toggleClass("on-click");
    $(".txt-hide").slideToggle(1000);
  });
});
</script>
